{"version":3,"sources":["../src/ScrollView.js"],"names":["ScrollList","state","itemsHeight","itemsTop","scrollTop","props","handleScroll","setState","e","target","handleItemRectChange","index","rect","items","defaultItemHeight","top","height","map","item","retTop","element","addEventListener","removeEventListener","children","style","position","left","viewportHeight","reduce","acc","itemHeight","start","Math","max","end","min","length","slice","renderItem","overflow","zIndex","renderItems","propTypes","number","isRequired","array","defaultProps"],"mappings":"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","file":"ScrollView.js","sourcesContent":["import React, { Component } from 'react';\nimport PropTypes from 'prop-types';\n\nimport ScrollListItem from './ScrollListItem';\n\nclass ScrollList extends Component {\n  static propTypes = {\n    defaultItemHeight: PropTypes.number,\n    viewportHeight: PropTypes.number.isRequired,\n    scrollTop: PropTypes.number,\n    items: PropTypes.array.isRequired\n  };\n\n  static defaultProps = {\n    scrollTop: 0,\n    defaultItemHeight: 30\n  };\n\n  state = {\n    itemsHeight: [],\n    itemsTop: [],\n    scrollTop: this.props.scrollTop\n  };\n\n  componentDidMount() {\n    this.element.scrollTop = this.state.scrollTop;\n\n    this.element.addEventListener('scroll', this.handleScroll, false);\n  }\n\n  componentWillUnmount() {\n    this.element.removeEventListener('scroll', this.handleScroll, false);\n  }\n\n  handleScroll = e => {\n    this.setState({ scrollTop: e.target.scrollTop });\n  };\n\n  handleItemRectChange = (index, rect) => {\n    const { items, defaultItemHeight } = this.props;\n    const { itemsHeight } = this.state;\n    let top = 0;\n\n    itemsHeight[index] = rect.height;\n\n    const itemsTop = items.map((item, index) => {\n      const retTop = top;\n\n      top += itemsHeight[index] || defaultItemHeight;\n\n      return retTop;\n    });\n\n    this.setState({ itemsHeight, itemsTop });\n  };\n\n  renderItem(item, index) {\n    const { defaultItemHeight, items, children } = this.props;\n    const { itemsHeight, itemsTop } = this.state;\n    const style = {\n      position: 'absolute',\n      left: '0',\n      height: `${defaultItemHeight}px`\n    };\n\n    if (itemsHeight[index]) {\n      style.height = `${itemsHeight[index]}px`;\n    }\n\n    if (typeof itemsTop[index] !== 'undefined') {\n      style.top = `${itemsTop[index]}px`;\n    }\n\n    return (\n      <div\n        style={style}\n        key={`item${index}-${itemsTop[index]}-${itemsHeight[index]}`}\n      >\n        <ScrollListItem index={index} onRectChange={this.handleItemRectChange}>\n          {children(items[index])}\n        </ScrollListItem>\n      </div>\n    );\n  }\n\n  renderItems() {\n    const { defaultItemHeight, viewportHeight, items } = this.props;\n    const { itemsHeight, scrollTop } = this.state;\n\n    const { start, end, height } = items.reduce(\n      function(acc, item, index) {\n        const itemHeight = itemsHeight[index] || defaultItemHeight;\n\n        acc.height += itemHeight;\n\n        // start index\n        if (acc.height >= scrollTop && typeof acc.start === 'undefined') {\n          acc.start = Math.max(index - 5, 0);\n        }\n\n        // end index\n        if (\n          acc.height - scrollTop > viewportHeight &&\n          typeof acc.end === 'undefined'\n        ) {\n          acc.end = Math.min(index + 5, items.length - 1);\n        }\n\n        return acc;\n      },\n      { height: 0 }\n    );\n\n    return (\n      <div style={{ height: `${height}px`, position: 'relative' }}>\n        {items.slice(start, end).map((item, index) => {\n          return this.renderItem(item, index + start);\n        })}\n      </div>\n    );\n  }\n\n  render() {\n    const { viewportHeight } = this.props;\n    const style = {\n      height: `${viewportHeight}px`,\n      overflow: 'scroll',\n      zIndex: 100000\n    };\n\n    return (\n      <div\n        ref={element => {\n          this.element = element;\n        }}\n        style={style}\n      >\n        {this.renderItems()}\n      </div>\n    );\n  }\n}\n\nexport default ScrollList;\n"]}